<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#0b0b0f" />
    <title>Smart Autoplay Video</title>

    <style>
        :root {
            --bg: #0b0b0f;
            --panel: #11131a;
            --text: #f5f7ff;
            --muted: #b8bccb;
            --accent: #7aa2ff;
            --radius: 18px;
            --shadow: 0 10px 30px rgba(0, 0, 0, .35);
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Arial, sans-serif;
            color: var(--text);
            background:
                radial-gradient(900px 900px at 10% -10%, rgba(122, 162, 255, 0.18), transparent 60%),
                radial-gradient(900px 900px at 90% 20%, rgba(120, 255, 214, 0.10), transparent 60%),
                var(--bg);
            -webkit-font-smoothing: antialiased;
            padding:
                max(14px, env(safe-area-inset-top)) 14px max(18px, env(safe-area-inset-bottom));
        }

        .app {
            max-width: 520px;
            margin: 0 auto;
            display: grid;
            gap: 14px;
            min-height: 100%;
            align-content: start;
        }

        header {
            padding: 8px 4px 0;
        }

        .title {
            font-size: 1.35rem;
            font-weight: 700;
            margin: 0 0 6px;
        }

        .subtitle {
            margin: 0;
            color: var(--muted);
            font-size: .95rem;
            line-height: 1.45;
        }

        .video-card {
            background: linear-gradient(160deg, rgba(255, 255, 255, 0.04), transparent 55%), var(--panel);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        /* 竖屏主视觉 9:16 */
        .video-wrap {
            position: relative;
            aspect-ratio: 16 / 9;
            background: #05060a;
        }

        video {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
            /* 不想裁切就改成 contain */
            background: #05060a;
        }

        .meta {
            padding: 14px 14px 16px;
            display: grid;
            gap: 8px;
        }

        .meta-title {
            font-size: 1.05rem;
            font-weight: 650;
            margin: 0;
        }

        .desc {
            margin: 0;
            color: var(--muted);
            font-size: .95rem;
            line-height: 1.5;
        }

        footer {
            margin-top: 6px;
            padding: 0 4px 10px;
            color: #8f96ab;
            font-size: .78rem;
            text-align: center;
        }

        @media (max-width: 360px) {
            .title {
                font-size: 1.2rem;
            }

            .subtitle,
            .desc {
                font-size: .9rem;
            }
        }

        /* ===== 全屏提示覆盖层 ===== */
        .gate {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: none;
            /* 默认隐藏，由 JS 决定显示 */
            padding:
                max(18px, env(safe-area-inset-top)) 18px max(18px, env(safe-area-inset-bottom));
            background:
                radial-gradient(1200px 1200px at 50% 20%, rgba(122, 162, 255, 0.18), transparent 60%),
                rgba(0, 0, 0, 0.65);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .gate.show {
            display: grid;
            place-items: center;
        }

        .gate-card {
            width: min(92vw, 420px);
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 22px;
            padding: 22px 20px 18px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, .45);
            text-align: center;
        }

        .gate-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 0 0 8px;
        }

        .gate-sub {
            margin: 0 0 16px;
            color: var(--muted);
            font-size: .95rem;
            line-height: 1.5;
        }

        .gate-btn {
            appearance: none;
            border: 1px solid rgba(122, 162, 255, 0.55);
            background:
                linear-gradient(135deg, rgba(122, 162, 255, 0.30), rgba(75, 123, 255, 0.22));
            color: #fff;
            padding: 12px 16px;
            border-radius: 14px;
            font-size: 1rem;
            font-weight: 650;
            cursor: pointer;
            width: 100%;
            transition: filter .15s ease, transform .15s ease;
        }

        .gate-btn:active {
            transform: scale(0.99);
            filter: brightness(0.98);
        }

        .gate-hint {
            margin: 10px 0 0;
            font-size: .78rem;
            color: #9aa2b8;
        }
    </style>
</head>

<body>
    <main class="app">
        <header>
            <h1 class="title">智能自动播放（优先有声）</h1>
            <p class="subtitle">
                先尝试不静音自动播放；若被浏览器策略拦截，则弹出全屏提示，需用户点击后播放。
            </p>
        </header>

        <section class="video-card">
            <div class="video-wrap">
                <video id="player" src="video/baka2.mp4" poster="poster.jpg" playsinline preload="metadata" loop
                    controls>
                    你的浏览器不支持 video 标签。
                </video>
            </div>

            <div class="meta">
                <h2 class="meta-title">示例标题：你的作品/项目名称</h2>
                <p class="desc">
                    这里写简短说明（2-4 行最佳）：用途、亮点、实验条件或展示语。
                    结构适配竖屏手机浏览。
                </p>
            </div>
        </section>

        <footer>
            Replace: video.mp4 / poster.jpg
        </footer>
    </main>

    <!-- 全屏“点按开始”覆盖层 -->
    <div class="gate" id="gate" role="dialog" aria-modal="true" aria-label="Start video">
        <div class="gate-card">
            <p class="gate-title">点击开始播放</p>
            <p class="gate-sub">
                你的浏览器阻止了“有声自动播放”。<br />
                点击按钮后将开始播放。
            </p>
            <button class="gate-btn" id="gateBtn">开始播放</button>
            <p class="gate-hint">若仍无声，请在控制条中确认音量未被系统静音。</p>
        </div>
    </div>

    <script>
        const player = document.getElementById("player");
        const gate = document.getElementById("gate");
        const gateBtn = document.getElementById("gateBtn");

        let autoplayAttempted = false;

        function showGate() {
            gate.classList.add("show");
            // 防止背景滚动
            document.documentElement.style.overflow = "hidden";
            document.body.style.overflow = "hidden";
        }

        function hideGate() {
            gate.classList.remove("show");
            document.documentElement.style.overflow = "";
            document.body.style.overflow = "";
        }

        async function tryAutoplayWithSound() {
            if (autoplayAttempted) return;
            autoplayAttempted = true;

            try {
                // 关键：尝试有声自动播放
                player.muted = false;
                player.autoplay = true;

                const p = player.play();
                if (p && typeof p.then === "function") {
                    await p; // 成功则直接播放
                }
                hideGate();
            } catch (err) {
                // 有声自动播放失败 → 等待用户手势
                player.pause();
                showGate();
            }
        }

        async function playAfterUserGesture() {
            try {
                // 用户点击后优先有声播放
                player.muted = false;
                const p = player.play();
                if (p && typeof p.then === "function") {
                    await p;
                }
                hideGate();
            } catch (err) {
                // 极端兜底：若仍失败，改成静音播放以确保能启动
                try {
                    player.muted = true;
                    const p2 = player.play();
                    if (p2 && typeof p2.then === "function") {
                        await p2;
                    }
                    hideGate();
                } catch (e2) {
                    // 仍失败就保持 controls 让用户自行处理
                }
            }
        }

        // 点击覆盖层按钮开始播放
        gateBtn.addEventListener("click", playAfterUserGesture);

        // 也允许点击半透明区域任意位置触发（更符合手机习惯）
        gate.addEventListener("click", (e) => {
            if (e.target === gate) playAfterUserGesture();
        });

        // 页面加载后尝试
        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", tryAutoplayWithSound);
        } else {
            tryAutoplayWithSound();
        }

        // 从后台切回前台再尝试一次（不重复打扰：只在未成功播放过且 gate 未显示时）
        document.addEventListener("visibilitychange", () => {
            if (!document.hidden && !gate.classList.contains("show") && player.paused) {
                autoplayAttempted = false; // 允许重试一次
                tryAutoplayWithSound();
            }
        });
    </script>
</body>

</html>